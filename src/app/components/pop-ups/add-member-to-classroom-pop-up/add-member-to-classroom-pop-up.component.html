<o-loading [isLoading]="isLoading" />

<o-pop-up-header [title]="'Adicionar membros à turma ' + ctx.classroom?.name" />

<mat-dialog-content class="add-members-popup">

    <!-- Search bar -->
    <div class="search-row">
        <mat-form-field appearance="fill" subscriptSizing="dynamic" class="search-field">
            <mat-label>Filtrar usuários</mat-label>
            <input matInput type="text" [(ngModel)]="filter" (keydown.enter)="filter.length && search()"
                placeholder="Nome, email ou identificador" />
        </mat-form-field>

        <button mat-icon-button class="search-btn" (click)="search()" [disabled]="!filter.length"
            pTooltip="Pesquisar (Enter)">
            <mat-icon>search</mat-icon>
        </button>
    </div>

    <!-- Results + empty state -->
    <div class="results">
        @if (showMessage && filteredUsers.length === 0) {
        <div class="empty">
            <mat-icon>search_off</mat-icon>
            <p>Nenhum resultado</p>
        </div>

        } @else {
        <div class="results-list">
            @for (userAccount of filteredUsers; track userAccount.id) {
            <button mat-raised-button class="result-item" [disabled]="isAlreadySelected(userAccount)"
                (click)="selectUser(userAccount)">
                {{ userAccount.user.name }} • {{ userAccount.idInInstitution }}
            </button>
            }
        </div>
        }
    </div>

    <!-- Selected chips -->
    <mat-chip-set>
        @for (userAccount of selectedUsers; track userAccount.id) {
        <mat-chip [removable]="true" (removed)="removeUser(userAccount)">
            {{ userAccount.user.name }} • {{ userAccount.idInInstitution }}
            <button matChipRemove>
                <mat-icon>cancel</mat-icon>
            </button>
        </mat-chip>
        }
    </mat-chip-set>

</mat-dialog-content>

<o-pop-up-buttons cancelButton="Cancelar" confirmButton="Adicionar" [disable]="isLoading || selectedUsers.length === 0"
    (confirm)="addUsersToClassroom()" />