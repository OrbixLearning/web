<o-loading [isLoading]="isLoading" />

<o-sub-header [buttons]="headerButtons" />

<div class="classroom-home">
    <!-- Left: chat -->
    <section class="left-content panel">
        <div class="panel__body">
            <o-chat style="width: 100%" [learningPaths]="learningPathsInChat"
                (removeLearningPath)="removeLearningPathFromChat($event)"
                message="Essa IA sabe todo o conteúdo desta turma e pode te ajudar a aprender da maneira mais eficiente e confiável!" />
        </div>
    </section>

    <!-- Right: filters + lists -->
    <aside class="right-content">
        <div class="filter-div panel">
            <header class="panel__header">
                <h3>Filtro</h3>
            </header>

            <div class="panel__body filter-row">
                <o-text-button (click)="syllabuspo.toggle($event)">
                    Ementa ({{ syllabusFilter.length }})
                </o-text-button>
                <p-popover #syllabuspo>
                    <o-syllabus [syllabus]="ctx.classroom?.syllabus" mode="filter"
                        (syllabusMarked)="markSyllabus($event)" [presets]="ctx.classroom?.presets" />
                </p-popover>

                <mat-form-field appearance="outline" subscriptSizing="dynamic" class="full">
                    <mat-label>Pesquisar</mat-label>
                    <input matInput [(ngModel)]="filter" />
                </mat-form-field>
            </div>
        </div>

        <div class="learning-paths-div">
            <!-- My learning paths -->
            <section class="learning-paths panel">
                <header class="panel__header">
                    <h3>Minhas rotas</h3>
                    @if (filteredMyLearningPaths.length > myLearningPathsPaginator.size) {
                    <mat-paginator (page)="paginatorChange(myLearningPathsPaginator, $event)"
                        [length]="filteredMyLearningPaths.length" [pageSize]="myLearningPathsPaginator.size"
                        [pageIndex]="myLearningPathsPaginator.index" [hidePageSize]="true" />
                    }
                </header>

                <div class="panel__body lp-list">
                    @if (filteredMyNotGeneratedLearningPaths.length > 0) {
                    <h5 class="group-title">Rotas em geração</h5>
                    @for (learningPath of paginatedFilteredMyNotGeneratedLearningPaths; track learningPath.id) {
                    <o-learning-path-card [learningPath]="learningPath"
                        (regenerate)="regenerateLearningPath(learningPath)" [mine]="true" />
                    }
                    <p-divider />
                    <h5 class="group-title">Rotas geradas</h5>
                    }

                    @for (learningPath of paginatedFilteredMyGeneratedLearningPaths; track learningPath.id) {
                    <o-learning-path-card [learningPath]="learningPath" (cardClick)="goToLearningPath(learningPath)"
                        [inChat]="isLearningPathIdInChat(learningPath.id)"
                        (addToChat)="addLearningPathToChat(learningPath)" (share)="shareLearningPath(learningPath)"
                        [mine]="true" />
                    }
                </div>
            </section>

            <!-- Shared learning paths -->
            <section class="learning-paths panel">
                <header class="panel__header">
                    <h3>Rotas compartilhadas</h3>
                    @if ((filteredTeacherLearningPaths.length || 0) + (filteredStudentLearningPaths.length || 0) >
                    sharedLearningPathsPaginator.size) {
                    <mat-paginator (page)="paginatorChange(sharedLearningPathsPaginator, $event)"
                        [length]="(filteredTeacherLearningPaths.length || 0) + (filteredStudentLearningPaths.length || 0)"
                        [pageSize]="sharedLearningPathsPaginator.size" [pageIndex]="sharedLearningPathsPaginator.index"
                        [hidePageSize]="true" />
                    }
                </header>

                <div class="panel__body lp-list">
                    <h5 class="group-title">Rotas de professor</h5>
                    @for (learningPath of paginatedFilteredTeacherLearningPaths; track learningPath.id) {
                    <o-learning-path-card [learningPath]="learningPath" (cardClick)="goToLearningPath(learningPath)"
                        [inChat]="isLearningPathIdInChat(learningPath.id)"
                        (addToChat)="addLearningPathToChat(learningPath)"
                        (sharedChange)="shareLearningPath(learningPath)" />
                    }

                    <p-divider />

                    <h5 class="group-title">Rotas de alunos</h5>
                    @for (learningPath of paginatedFilteredStudentLearningPaths; track learningPath.id) {
                    <o-learning-path-card [learningPath]="learningPath" (cardClick)="goToLearningPath(learningPath)"
                        [inChat]="isLearningPathIdInChat(learningPath.id)"
                        (addToChat)="addLearningPathToChat(learningPath)"
                        (sharedChange)="shareLearningPath(learningPath)" />
                    }
                </div>
            </section>
        </div>
    </aside>
</div>