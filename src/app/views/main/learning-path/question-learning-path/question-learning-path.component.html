<div class="question">

    <!-- LEFT: current question -->
    <section class="q-left">
        <header class="q-header">
            <h3 class="q-title">Quest찾o {{ index + 1 }} de {{ questionsContext.length }}</h3>
        </header>

        <div class="q-statement">
            <p>{{ question?.statement }}</p>
        </div>

        <div class="q-choices">
            @switch (question?.type) {
            @case (questionTypeEnum.MULTIPLE_CHOICE) {
            <mat-selection-list class="choices" [multiple]="false">
                @for (option of question?.options; track option) {
                <mat-list-option class="choice-item" [selected]="userAnswer.includes(option)"
                    (click)="markSingle(option)" role="radio" [attr.aria-checked]="userAnswer.includes(option)">
                    {{ option }}
                </mat-list-option>
                }
            </mat-selection-list>
            }

            @case (questionTypeEnum.MULTIPLE_SELECTION) {
            <mat-selection-list class="choices" [multiple]="true">
                @for (option of question?.options; track option) {
                <mat-list-option class="choice-item" [selected]="userAnswer.includes(option)"
                    (click)="markMulti(option)" role="checkbox" [attr.aria-checked]="userAnswer.includes(option)">
                    {{ option }}
                </mat-list-option>
                }
            </mat-selection-list>
            }

            @case (questionTypeEnum.TRUE_FALSE) {
            <mat-button-toggle-group class="tf-group">
                <mat-button-toggle [checked]="userAnswer.includes('true')" (change)="markSingle('true')" value="true">
                    Verdadeiro
                </mat-button-toggle>
                <mat-button-toggle [checked]="userAnswer.includes('false')" (change)="markSingle('false')"
                    value="false">
                    Falso
                </mat-button-toggle>
            </mat-button-toggle-group>
            }

            @case (questionTypeEnum.OPEN_ENDED) {
            <mat-form-field appearance="outline" subscriptSizing="dynamic" class="open-ended">
                <mat-label>Resposta</mat-label>
                <textarea matInput rows="6" [value]="userAnswer[0] || ''" (input)="updateOpenEndedAnswer($event)">
            </textarea>
            </mat-form-field>
            }
            }
        </div>

        @if (showAnswers) {
        <div class="q-correct">
            <span class="label">Resposta correta:</span>
            <span class="value">{{ currentQuestionAnswer }}</span>
        </div>
        }

        <div class="q-nav">
            @if (index > 0) {
            <o-text-button (onclick)="previousQuestion()">Anterior</o-text-button>
            }
            @if (index < (questionsContext.length - 1)) { <o-text-button (onclick)="nextQuestion()">
                Pr처xima</o-text-button>
                }
        </div>
    </section>

    <!-- RIGHT: list + actions -->
    <aside class="q-right">
        <div class="questions-menu">
            @for (context of questionsContext; track $index; let i = $index) {
            <button mat-stroked-button class="q-item" (click)="goToQuestion(i)"
                [class.answered]="context.userAnswer.length > 0" [class.incorrect]="showAnswers && !verifyAnswer(i)">
                <mat-icon>{{ context.userAnswer.length > 0 ? 'check' : 'close' }}</mat-icon>
                <span>Quest찾o {{ i + 1 }} {{ context.userAnswer.length > 0 ? '' : '(n찾o respondida)' }}</span>
            </button>
            }
        </div>

        <div class="q-actions">
            @if (!showAnswers) {
            <o-highlight-button (onclick)="verifyAnswers()">Verificar Respostas</o-highlight-button>
            } @else {
            <p class="q-summary">{{ amountOfIncorrectAnswers }} respostas incorretas</p>
            <o-text-button (onclick)="showAnswers = false">Esconder Respostas</o-text-button>
            }
        </div>
    </aside>
</div>