<div class="profile-container">
  <o-loading [isLoading]="isLoading" />

  <header class="profile-header">
    <button mat-icon-button class="back-button" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
  </header>

  <main class="profile-content">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      
      <div class="profile-card">
        <h2 class="card-title">Configuração de Perfil</h2>
        <div class="user-details">
          
          <div class="avatar-section">
            <img [src]="picturePreview || profilePictureUrl" alt="Foto de perfil" class="user-avatar" />
            
            <!-- <button mat-fab color="primary" class="upload-button" type="button" (click)="fileUploader.click()">
              <mat-icon>photo_camera</mat-icon>
            </button> -->
            
            <!-- <input type="file" #fileUploader hidden accept="image/*" (change)="selectProfilePicture($event)" /> -->
          </div>

          <mat-form-field appearance="outline" class="name-input">
            <mat-label>Seu Nome</mat-label>
            <input matInput formControlName="name" required />
          </mat-form-field>

          <button mat-flat-button color="primary" class="action-button save-button" type="submit" [disabled]="disableSaveButton">
            <mat-icon>save</mat-icon>
            <span>Salvar</span>
          </button>
        </div>
      </div>

      <div class="profile-card">
        <div class="card-header">
          <h2 class="card-title">Contas Vinculadas</h2>
          <button mat-stroked-button class="action-button" type="button" (click)="linkAccount()">
            <mat-icon>add_link</mat-icon>
            <span>Vincular Conta</span>
          </button>
        </div>

        <div class="linked-accounts-list">
          @for (account of sortedAccounts; track account.id) {
            <span class="debug-email">{{ account.email }}</span> <!-- debug rápido -->
            <o-account-card [account]="account" [showAvatar]="false" />
          } @empty {
            <p class="empty-message">Nenhuma conta institucional vinculada.</p>
          }
        </div>
      </div>
    </form>
  </main>
</div>