<o-loading [isLoading]="isLoading" />

<header class="roadmap-header">
    <button mat-icon-button [routerLink]="['/i/' + this.ctx.institution?.id + '/c/' + this.ctx.classroom?.id]">
        <mat-icon>arrow_back</mat-icon>
    </button>

    <mat-icon>{{ctx.roadmapStudy?.roadmap?.icon}}</mat-icon>

    @if (ctx.roadmapStudy?.roadmap?.validated) {
    <mat-icon pTooltip="Rota validada pelo professor">check</mat-icon>
    } @else if (ctx.isTeacher) {
    <button mat-raised-button (click)="validateRoadmap()">
        Validar rota
    </button>
    }

    <button mat-raised-button (click)="toggleMode()">
        <mat-icon>{{mode === 'view' ? 'visibility' : 'school'}}</mat-icon>
        Modo {{mode === 'view' ? 'Visualização' : 'Estudo'}}
    </button>

    @if (mine) {
    <div>
        <p-toggleswitch [(ngModel)]="ctx.roadmapStudy!.roadmap!.shared" (ngModelChange)="updatedRoadmapSharing()" />
        <span>Compartilhada</span>
    </div>

    <button mat-icon-button (click)="deleteRoadmap()">
        <mat-icon>delete</mat-icon>
    </button>
    }
</header>

<div class="roadmap-content">
    <div>
        @switch (ctx.roadmapStudy!.roadmap!.type) {
        @case (typeEnum.TEXT) {
        <o-text-roadmap [roadmapStudy]="roadmapStudyAsText" />
        }
        @case (typeEnum.VIDEO) {
        <o-video-roadmap [roadmapStudy]="roadmapStudyAsVideo" />
        }
        @case (typeEnum.AUDIO) {
        <o-audio-roadmap [roadmapStudy]="roadmapStudyAsAudio" />
        }
        @case (typeEnum.FLASHCARD) {
        <o-flash-card-roadmap [roadmapStudy]="roadmapStudyAsFlashCard" />
        }
        @case (typeEnum.QUESTION) {
        <o-question-roadmap [roadmapStudy]="roadmapStudyAsQuestion" />
        }
        }
    </div>

    @if (mode === 'study') {
    <div class="roadmap-aichat">
        <p>Aqui terá um chat com a IA</p>
        <p>Para ajudar a responder perguntas sobre a rota</p>
        <p>e auxiliar no estudo</p>
        <p>Em breve!</p>
    </div>
    }
</div>