<o-loading [isLoading]="isLoading" />

<div class="institution-settings">
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-div">
        <p class="title">Configurações da Instituição {{ ctx.institution?.name }}</p>

        <mat-form-field subscriptSizing="dynamic" appearance="outline">
            <mat-label>Nome da Instituição</mat-label>
            <input matInput name="name" formControlName="name" required />
        </mat-form-field>

        <div class="logo-div">
            <p>Logo</p>
            <div class="logo-subdiv">
                <div class="logo-frame">
                    <img [src]="logoUrl" alt="Institution logo" />
                </div>

                <p-divider layout="vertical" />

                @if (!logo) {
                <p-fileupload mode="basic" chooseLabel="Selecionar" name="logo" [auto]="true" accept=".png,.svg"
                    [maxFileSize]="MAX_IMAGE_SIZE" (onSelect)="selectLogo($event)" />
                } @else {
                <div class="logo-frame preview">
                    <img [src]="logoPreview" alt="Logo preview" />
                </div>
                <button mat-button (click)="logo = undefined" type="button">
                    <mat-icon>close</mat-icon>Cancelar
                </button>
                }
            </div>
        </div>

        <div class="color-row-div">
            <div class="color-div">
                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                    <mat-label>Cor primária</mat-label>
                    <input matInput name="primaryColor" formControlName="primaryColor"
                        [(ngModel)]="this.getFormControl('primaryColor').value" required />
                </mat-form-field>
                <p-colorpicker [(ngModel)]="this.getFormControl('primaryColor').value" formControlName="primaryColor" />
            </div>

            <div class="color-div">
                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                    <mat-label>Cor secundária</mat-label>
                    <input matInput name="secondaryColor" formControlName="secondaryColor"
                        [(ngModel)]="this.getFormControl('secondaryColor').value" required />
                </mat-form-field>
                <p-colorpicker [(ngModel)]="this.getFormControl('secondaryColor').value"
                    formControlName="secondaryColor" />
            </div>
        </div>

        <div class="color-row-div">
            <div class="color-div">
                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                    <mat-label>Cor de fundo</mat-label>
                    <input matInput name="backgroundColor" formControlName="backgroundColor"
                        [(ngModel)]="this.getFormControl('backgroundColor').value" required />
                </mat-form-field>
                <p-colorpicker [(ngModel)]="this.getFormControl('backgroundColor').value"
                    formControlName="backgroundColor" />
            </div>

            <div class="color-div">
                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                    <mat-label>Cor do texto</mat-label>
                    <input matInput name="textColor" formControlName="textColor"
                        [(ngModel)]="this.getFormControl('textColor').value" required />
                </mat-form-field>
                <p-colorpicker [(ngModel)]="this.getFormControl('textColor').value" formControlName="textColor" />
            </div>
        </div>

        <mat-form-field subscriptSizing="dynamic" appearance="outline">
            <mat-label>Tema</mat-label>
            <mat-select name="theme" formControlName="theme" required>
                <mat-option value="light">Claro</mat-option>
                <mat-option value="dark">Escuro</mat-option>
            </mat-select>
        </mat-form-field>

        <div class="actions">
            <o-text-button (onclick)="resetForm()">
                Cancelar
            </o-text-button>
            <o-highlight-button cdkInitialFocus icon="save" type="submit" [disabled]="disableSaveButton">
                Salvar
            </o-highlight-button>
        </div>
    </form>

    <div class="right-div">
        <div class="buttons-div">
            <o-highlight-button (onclick)="goToUsers()">
                Usuários
            </o-highlight-button>
            <o-highlight-button (onclick)="goToClassrooms()">
                Turmas
            </o-highlight-button>
        </div>

        @if (!ctx.institution?.domains || ctx.institution?.domains?.length === 0) {
        <p>Não há domínios cadastrados na sua instituição.</p>
        <p><a [routerLink]="['/report']">Entre em contato com o suporte para cadastrar domínios.</a></p>
        } @else {
        <h3>Domínios:</h3>
        <ul>
            @for (domain of ctx.institution?.domains; track domain) {
            <li>&#64;{{ domain }}</li>
            }
        </ul>
        }
    </div>
</div>