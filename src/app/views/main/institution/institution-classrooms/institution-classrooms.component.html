<o-loading [isLoading]="isLoading" />

<!-- Header -->
<header class="ics-header">
    <button mat-icon-button [routerLink]="['/i/' + this.ctx.institution?.id + '/settings']">
        <mat-icon>arrow_back</mat-icon>
    </button>

    <div>
        <o-highlight-button (onclick)="createClassroom()">Criar turmas</o-highlight-button>

        <o-text-button (onclick)="deleteSelectedClassrooms()" [disabled]="selectedClassrooms.length === 0">Excluir
            turmas</o-text-button>
    </div>
</header>

<!-- Table -->
<p-table [value]="classrooms" size="small" dataKey="id" [lazy]="true" (onLazyLoad)="getClassrooms($event)"
    [loading]="isLoading" [(selection)]="selectedClassrooms" [first]="paginationFirst" [paginator]="true" [rows]="10"
    [rowsPerPageOptions]="[5, 10, 20, 30]" [showCurrentPageReport]="true" [totalRecords]="totalRecords"
    currentPageReportTemplate="Página {currentPage} de {totalPages}" paginatorPosition="both" [tableStyle]="tableStyle">

    <ng-template #header>
        <!-- Filters -->
        <tr class="filters-row">
            <th></th>
            <th></th>
            <th>
                <p-columnFilter [showMenu]="false" type="text" field="name" placeholder="Filtrar nome" />
            </th>
            <th></th>
            <th></th>
        </tr>

        <!-- Header -->
        <tr class="thead-row">
            <th><p-tableHeaderCheckbox /></th>
            <th style="width:20%">Ícone</th>
            <th style="width:30%">Nome</th>
            <th style="width:25%">Ementa</th>
            <th style="width:20%">Configurar</th>
        </tr>

    </ng-template>
    <ng-template #body let-classroom let-editing="editing">

        <!-- Body -->
        <tr>
            <td> <p-tableCheckbox [value]="classroom" /> </td>
            <td>
                <button mat-icon-button class="icon-cell-button" (click)="op.toggle($event)">
                    <mat-icon>{{ classroom.icon }}</mat-icon>
                </button>
                <p-popover #op>
                    <div class="icon-popover">
                        <input type="text" pInputText [(ngModel)]="classroom.icon" (change)="updateClassroom(classroom)"
                            (keydown.enter)="updateClassroom(classroom)" />

                        <p>
                            É possível verificar a lista de ícones em
                            <a href="https://fonts.google.com/icons?icon.set=Material+Icons" target="_blank">
                                Google Icons
                            </a>
                        </p>
                    </div>
                </p-popover>
            </td>

            <td [pEditableColumn]="classroom.name" pEditableColumnField="name">
                <p-cellEditor>
                    <ng-template #input>
                        <input type="text" pInputText [(ngModel)]="classroom.name" (change)="updateClassroom(classroom)"
                            (keydown.enter)="updateClassroom(classroom)" />
                    </ng-template>
                    <ng-template #output>
                        {{ classroom.name }}
                    </ng-template>
                </p-cellEditor>
            </td>
            <td>{{ classroom.syllabus?.length > 0 ? "Sim" : "Não"}}</td>
            <td>
                <button mat-icon-button [routerLink]="['/i/' + ctx.institution?.id + '/c/' + classroom.id]">
                    <mat-icon>{{ classroom.icon }}</mat-icon>
                </button>
            </td>
        </tr>

    </ng-template>
</p-table>